<div class="orders-page">

  <h2>БД пользователей</h2>

  <div class="admin-nav">
    <a href="/orders/active" class="btn-sec">К активным заказам</a>
    <a href="/orders/archive" class="btn-sec">К архиву заказов</a>
  </div>

  <!-- Фильтр по логину -->
  <form method="get" action="/admin/users" class="status-sort" style="margin-bottom:1rem;">
    <label for="login" class="status-label">Логин:</label>
    <input
      type="text"
      id="login"
      name="login"
      value="{{loginFilter}}"
      placeholder="Поиск по логину"
      class="status-field">
    <button type="submit" class="btn-sec">Применить</button>
    {{#if loginFilter}}
      <a href="/admin/users" class="reset-btn">Сбросить</a>
    {{/if}}
  </form>

  <div class="table-container">
    <table class="orders-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Имя</th>
          <th>Логин</th>
          <th>Роль</th>
          <th>Бан</th>
          <th>Действия</th>
        </tr>
      </thead>
      <tbody>
        {{#each users}}
        <tr>
          <td>{{id}}</td>
          <td>{{name}}</td>
          <td>{{login}}</td>
          <td>{{role}}</td>
          <td class="action-cell">
            <!-- Изменить пароль -->
            <form method="post" action="/admin/users/{{id}}/password" class="action-form">
              <input
                type="password"
                name="password"
                placeholder="Новый пароль"
                required
                style="padding:.25rem .5rem; background:#232323; color:#fff; border:1px solid #444; border-radius:3px;">
              <button type="submit" class="btn-sec">Сменить</button>
            </form>

            <!-- Удалить пользователя -->
            <form
              method="post"
              action="/admin/users/{{id}}/delete"
              class="action-form"
              onsubmit="return confirm('Удалить пользователя {{login}}?');">
              <button type="submit" class="btn-arch">Удалить</button>
            </form>
          </td>
          <td>
            {{#if ban_reason}}
              <div style="display:flex; flex-direction:column; gap:.2rem;">
                <span style="color:#ff6b6b; font-weight:600;">Забанен</span>
                <span style="font-size:.85rem; color:#aaa;">
                  {{#if ban_until}}
                    до {{date ban_until}}
                  {{else}}
                    навсегда
                  {{/if}}
                </span>
                <span style="font-size:.85rem; color:#aaa;">
                  причина: {{truncate ban_reason 30}}
                </span>

                <form method="post" action="/admin/users/{{id}}/unban" class="action-form">
                  <button type="submit" class="btn-sec">Разбанить</button>
                </form>
              </div>
            {{else}}
              <form method="post" action="/admin/users/{{id}}/ban" class="action-form" style="display:flex; gap:.4rem; flex-wrap:wrap;">
                <input
                  type="text"
                  name="reason"
                  placeholder="Причина"
                  required
                  maxlength="500"
                  style="padding:.25rem .5rem; background:#232323; color:#fff; border:1px solid #444; border-radius:3px; width:180px;">

                <select name="duration" style="padding:.25rem .5rem; background:#232323; color:#fff; border:1px solid #444; border-radius:3px;">
                  <option value="permanent">Навсегда</option>
                  <option value="1">1 день</option>
                  <option value="7">7 дней</option>
                  <option value="30">30 дней</option>
                </select>

                <button type="submit" class="btn-arch">Забанить</button>
              </form>
            {{/if}}
          </td>

        </tr>
        {{/each}}
      </tbody>
    </table>
  </div>

</div>
